"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[946],{32916:(e,t,a)=>{a.d(t,{SidebarProvider:()=>s,c:()=>n});var r=a(95155),o=a(12115);let l=(0,o.createContext)(void 0),n=()=>{let e=(0,o.useContext)(l);if(!e)throw Error("useSidebar must be used within a SidebarProvider");return e},s=e=>{let{children:t}=e,[a,n]=(0,o.useState)(!1);return(0,r.jsx)(l.Provider,{value:{collapsed:a,toggleCollapse:()=>{n(!a)},setCollapsed:n},children:t})}},54466:(e,t,a)=>{a.d(t,{ConnectionProvider:()=>s,w:()=>u});var r=a(95155),o=a(12115),l=a(62890);let n=(0,o.createContext)(void 0),s=e=>{let{children:t}=e,[a,s]=(0,o.useState)({supabaseConnected:!1,backendConnected:!1,lastChecked:null,isChecking:!1}),u=(0,o.useCallback)(async()=>{s(e=>({...e,isChecking:!0}));try{let e=!1;try{let t=(0,l.getSupabaseClient)();if(t){let{error:a}=await t.from("security_alerts").select("count").limit(1);e=!a}}catch(t){e=!1}let t=!1;try{let e="http://localhost:8000";{let t=localStorage.getItem("dashboardConfig");if(t)try{let a=JSON.parse(t);a.apiUrl&&(e=a.apiUrl)}catch(e){console.warn("Failed to parse saved config for connection check:",e)}}t=(await fetch("".concat(e,"/api/status"),{method:"GET",timeout:5e3})).ok}catch(e){t=!1}s({supabaseConnected:e,backendConnected:t,lastChecked:new Date,isChecking:!1})}catch(e){s(e=>({...e,isChecking:!1,lastChecked:new Date}))}},[]),i=(0,o.useCallback)(()=>{u()},[u]);return(0,o.useEffect)(()=>{u();let e=setInterval(u,3e4);return()=>clearInterval(e)},[u]),(0,r.jsx)(n.Provider,{value:{connectionState:a,checkConnections:u,refreshConnectionStatus:i},children:t})},u=()=>{let e=(0,o.useContext)(n);if(void 0===e)throw Error("useConnection must be used within a ConnectionProvider");return e}},62890:(e,t,a)=>{a.d(t,{getSupabaseClient:()=>n});var r=a(11993);let o=null,l=null;function n(e){let t="",a="";if(e)t=e.url,a=e.key;else{{let e=localStorage.getItem("dashboardConfig");if(e)try{let r=JSON.parse(e);r.supabaseUrl&&r.supabaseKey&&(t=r.supabaseUrl,a=r.supabaseKey)}catch(e){console.warn("Failed to parse saved config:",e)}}t&&a||(t="",a="")}if(!t||!a)return console.warn("Supabase URL and key not configured. Please set them in the settings or environment variables."),null;if("your_supabase_url_here"===t||"your_supabase_anon_key_here"===a||"https://your-project.supabase.co"===t||"your-anon-key"===a)return console.warn("Please configure actual Supabase credentials in settings or .env.local file"),null;let n={url:t,key:a};return l&&l.url===n.url&&l.key===n.key||(o=(0,r.createClient)(t,a,{auth:{persistSession:!0,autoRefreshToken:!0},realtime:{params:{eventsPerSecond:10}}}),l=n),o}},65380:(e,t,a)=>{a.d(t,{A:()=>d,AuthProvider:()=>c});var r=a(95155),o=a(20063),l=a(12115),n=a(62890);let s={isAuthenticated:!1,user:null,token:null,loading:!0,error:null};function u(e,t){switch(t.type){case"LOGIN_START":return{...e,loading:!0,error:null};case"LOGIN_SUCCESS":return console.log("LOGIN_SUCCESS reducer called with:",t.payload),{...e,isAuthenticated:!0,user:t.payload.user,token:t.payload.token,loading:!1,error:null};case"LOGIN_FAILURE":return{...e,isAuthenticated:!1,user:null,token:null,loading:!1,error:t.payload};case"LOGOUT":return{...e,isAuthenticated:!1,user:null,token:null,loading:!1,error:null};case"CLEAR_ERROR":return{...e,error:null};case"REFRESH_TOKEN":return{...e,user:t.payload.user,token:t.payload.token,loading:!1};case"SET_LOADING":return{...e,loading:t.payload};default:return e}}let i=(0,l.createContext)(void 0);function c(e){let{children:t}=e,[a,c]=(0,l.useReducer)(u,s),d=(0,o.useRouter)(),h=(0,l.useCallback)(e=>{try{let t=JSON.parse(atob(e.split(".")[1]));return null==t?void 0:t.user_id}catch(e){return!1}},[]);(0,l.useEffect)(()=>{try{let e=localStorage.getItem("matseka_auth_token"),t=localStorage.getItem("matseka_auth_user");if(e&&t){let a=JSON.parse(t);h(e)?c({type:"REFRESH_TOKEN",payload:{user:a,token:e}}):(localStorage.removeItem("matseka_auth_token"),localStorage.removeItem("matseka_auth_user"),c({type:"SET_LOADING",payload:!1}))}else c({type:"SET_LOADING",payload:!1})}catch(e){console.error("Auth initialization error:",e),c({type:"SET_LOADING",payload:!1})}},[h]);let p=e=>{let t={sub:e.id,username:e.username,role:e.role,iat:Math.floor(Date.now()/1e3),exp:Math.floor(Date.now()/1e3)+86400},a=btoa(JSON.stringify({alg:"HS256",typ:"JWT"})),r=btoa(JSON.stringify(t)),o=btoa("".concat(a,".").concat(r,".secret"));return"".concat(a,".").concat(r,".").concat(o)},m=async e=>{c({type:"LOGIN_START"});try{var t;let a=(0,n.getSupabaseClient)();if(!a)return c({type:"LOGIN_FAILURE",payload:"Database not configured"}),!1;let{data:r,error:o}=await a.auth.signInWithPassword({email:"".concat(e.username,"@matsekasuricata.local"),password:e.password});if(o||!r.user){let{data:t,error:r}=await a.from("admin_users").select("*").eq("username",e.username).single();if(r||!t)return c({type:"LOGIN_FAILURE",payload:"Invalid username or password"}),!1;let o={id:t.id,username:t.username,email:t.email||"",role:t.role||"admin",createdAt:t.created_at||new Date().toISOString()},l=p(o);return localStorage.setItem("matseka_auth_token",l),localStorage.setItem("matseka_auth_user",JSON.stringify(o)),c({type:"LOGIN_SUCCESS",payload:{user:o,token:l}}),d.push("/"),!0}let l={id:r.user.id,username:e.username,email:r.user.email||"",role:"admin",createdAt:new Date().toISOString()},s=(null==(t=r.session)?void 0:t.access_token)||p(l);return localStorage.setItem("matseka_auth_token",s),localStorage.setItem("matseka_auth_user",JSON.stringify(l)),c({type:"LOGIN_SUCCESS",payload:{user:l,token:s}}),console.log("Login successful, redirecting to dashboard..."),d.push("/"),!0}catch(e){return c({type:"LOGIN_FAILURE",payload:e.message||"Login failed. Please try again."}),!1}},y=async()=>{try{let e=(0,n.getSupabaseClient)();e&&await e.auth.signOut()}catch(e){console.error("Logout failed:",e)}finally{localStorage.removeItem("matseka_auth_token"),localStorage.removeItem("matseka_auth_user"),c({type:"LOGOUT"}),d.push("/")}},g=async()=>{try{let t=(0,n.getSupabaseClient)();if(localStorage.getItem("matseka_auth_token")&&t){let{data:{session:a}}=await t.auth.getSession();if(null==a?void 0:a.user){var e;let t={id:a.user.id,username:(null==(e=a.user.email)?void 0:e.split("@")[0])||"admin",email:a.user.email||"",role:"admin",createdAt:new Date().toISOString()};return c({type:"REFRESH_TOKEN",payload:{user:t,token:a.access_token}}),!0}}return!1}catch(e){return console.error("Token refresh error:",e),!1}},S={...a,login:m,logout:y,refreshToken:g,clearError:()=>{c({type:"CLEAR_ERROR"})}};return(0,r.jsx)(i.Provider,{value:S,children:t})}function d(){let e=(0,l.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}}}]);